<!DOCTYPE HTML>
<html>
<head>
    <link href="css/style.css" type="text/css" rel="stylesheet" />
    <title>Map Editor</title>
</head>
<body>
    <div id="map-main">
        <div id="map-grid">

        </div>
    </div>

    <div id="textures-controller">
        <!--use python to dynamically render all these images-->
        <img src="img/grass.jpg"  class="texture" />
        <img src="img/carbon.png" class="texture" />
        <img src="img/snow.png" class="texture" />
        <img src="img/redclay.png" class="texture" />
    </div>

    <script>
    var texture_path = "img/grass.jpg"; // default texture grass
    var is_mouse_down = false;
    var map_grid = document.getElementById("map-grid");
    window.addEventListener("mouseup", function() {
        is_mouse_down = false;
    });

    function create_grid_row(row_number) {
        var row = document.createElement('div');
        row.className = 'map-row';

        // row number isn't required (we can use access via array index)
        // might be handy in the future so might as well put it
        row.setAttribute("row-number", row_number);

        return row;
    }

    function create_individual_box(row_number, col_number) {
        var box = document.createElement('div');
        box.className = 'map-box';        
        box.setAttribute("row-number", row_number);
        box.setAttribute("col-number", col_number);
        box.appendChild(document.createElement('img'));
        box.addEventListener("click", change_box_image);
        box.addEventListener("mouseenter", change_box_image);
        
        return box;
    }

    // very buggy fix this. (mouse drag shoud also paint)
    function change_box_image(event) {
        if(event.type === "click") {
            event.srcElement.src = texture_path;
            is_mouse_down = true;
        }         
        else if (event.type === "mouseenter" && is_mouse_down) {
            console.log(event.srcElement);
            event.srcElement.src = texture_path;
        }

    }

    function clear_image(box_element) {

    }

    function add_columns(how_many) {
        
    }

    function change_texture_path(event) {
        texture_path = event.srcElement.src;        
    }

    function init_grid() {

        for (var i = 1; i <= 24; i++) {
            var row = create_grid_row(i);
            for (var j = 1; j <= 32; j++) {
                row.appendChild(create_individual_box(i, j));
            }
            map_grid.appendChild(row);
        }
    };

    function init_textures() {
        var textures = document.getElementsByClassName("texture");

        for (var i = 0; i < textures.length; i++) {
            textures[i].addEventListener("click", change_texture_path);
        }
    }

    init_grid();
    init_textures();

    </script>
</html>
